#!/bin/sh
#
# IMPORTANT:  READ BEFORE DOWNLOADING, COPYING, INSTALLING OR USING.
# By downloading, copying, installing or using the software you agree to this 
# license.  If you do not agree to this license, do not download, install,
# copy or use the software.
#
# Copyright (c) 2003, The MITRE Corporation
# All rights reserved.
# 
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are 
# met:
# 
# Redistributions of source code must retain the above copyright notice,
# this list of conditions and the following disclaimer.  Redistributions 
# in binary form must reproduce the above copyright notice, this list of 
# conditions and the following disclaimer in the documentation and/or 
# other materials provided with the distribution.
# 
# Neither the name of The MITRE Corporation nor the names of its 
# contributors may be used to endorse or promote products derived from 
# this software without specific prior written permission.
# 
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS 
# IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
# THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
# PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF 
# LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING 
# NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
# 
# $Id$
#

##############
#
# CFLAGS
##############
#
#

#########
#
# TARGET
#########
#
# native
# 
# cerfcube (or arm)
#

target=native

exec_prefix='/usr/local/DTN'
bindir='${exec_prefix}/bin'
sbindir='${exec_prefix}/sbin'
libdir='${exec_prefix}/lib'
idir='${exec_prefix}/include'
mandir='/usr/local/man/manl'


#
# Defaults
#
debug='-g'
optimize='-O'

# End of user configurable options

ac_prev=
for ac_option
do
  if  test -n "$ac_prev"; then
      eval "$ac_prev=\$ac_option"
      ac_prev=
      continue
  fi

  case "$ac_option" in
  -*=*) ac_optarg=`echo "$ac_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
  *) ac_optarg= ;;
  esac

  case "$ac_option" in

  -target | --target | -t)
    ac_prev=target ;;
  -target=* | --target=* | -t=*)
    target="$ac_optarg" ;;

  -exec-prefix | --exec-prefix | -ep)
    ac_prev=exec_prefix ;;
  -exec-prefix=* | --exec-prefix=* | -ep=*)
    exec_prefix="$ac_optarg" ;;

  -mandir | --mandir | -md)
    ac_prev=mandir ;;
  -mandir=* | --mandir=* | -md=*)
    mandir="$ac_optarg" ;;

  -enable-debug | --enable-debug)
    debug='-g' ;;
  -disable-debug | --disable-debug)
    debug='' ;;

  -enable-optimize | --enable-optimize)
    optimize='-O' ;;
  -disable-optimize | --disable-optimize)
    optimize='' ;;

  -help | --help | -h)
    cat <<EOF
Usage: configure [options]
Options [defaults in brackets after descriptions]
Directory and file names:
  --exec-prefix=EPREFIX           install architecture-independent files in PREFIX
                                  [$exec_prefix]
  --target=TARGET                 Configure for TARGET.  Valid targets are 'native'
                                  and 'arm' [$target]
  --mandir=MANUAL_DIR             Install man pages here [$mandir]
Features
     debug			  Include '-g' in the CFLAGS.
     optimize			  Include '-O' in the CFLAGS.

  --disable-FEATURE
  --enable-FEATURE[=ARG]
EOF
  exit 0
  ;;
  *)
    cat <<EOF
configure: unrecognized option \`$ac_option'.
Try \`configure --help' for more information.
EOF
  exit 1
  ;;
  esac
done

if [ $target == "arm" -o $target == "cerfcube" -o $target == "arm+apps" ]; then
	exec_prefix=`pwd`/Stage
	bindir='${exec_prefix}/bin'
	sbindir='${exec_prefix}/sbin'
	libdir='${exec_prefix}/lib'
	mandir='${exec_prefix}/man/manl'
	idir='${exec_prefix}/include'
	cflags='-g -Wall -DUSE_DB -DDB_PKG_SLEEPYCAT_$db_version -D_REENTRANT'
fi

echo "Options:"
echo "  TARGET is: $target"
echo "  Debug: $debug"
echo "  Optimize: $optimize"
echo " "
echo "Directories"
echo "  exec_prefix: $exec_prefix"
echo "  bindir:  $bindir"
echo "  sbindir: $sbindir"
echo "  libdir:  $libdir"
echo "  mandir:  $mandir"
echo "  idir:    $idir"

echo "#" > Rules.make
echo "# This file was automatically generated by configure; do not edit directly" > Rules.make
sed -e "
s%@EXEC_PREFIX@%$exec_prefix%g
s%@CFLAGS@%$cflags%g
s%@BINDIR@%$bindir%g
s%@SBINDIR@%$sbindir%g
s%@LIBDIR@%$libdir%g
s%@MANDIR@%$mandir%g
s%@TARGET@%$target%g
s%@INCDIR@%$idir%g
s%@DEBUG@%$debug%g
s%@OPTIMIZE@%$optimize%g
" Rules.make.in >> Rules.make

echo ""
echo "wrote Rules.make; now run make"
