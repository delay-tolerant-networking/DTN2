#
# Makefile for DTN2/applib
#

# Header files generated by rpcgen
XDRHDRS := dtn_types.h

# Sources sources for the dtn api library
APPLIB_SRCS := 				\
		dtn_types_xdr.c 	\
		dtn_api_internal.c	\

APPLIB_OBJS := $(APPLIB_SRCS:.c=.o)

ALLSRCS := $(APPLIB_SRCS)
GENFILES := $(XDRHDRS) $(XDRSRCS)

#
# Need special rules for the xdr generated sources
#
.SUFFIXES: .x
.x.h:
	-$(RM) -f $@
	$(RPCGEN) -h -N $< -o $@

# This little bit of sed hackery avoids a compiler warning due to the
# possibly unused variable 'buf'.
%_xdr.c: %.x
	$(RPCGEN) -c -N $< -o $@.tmp
	sed 's/register int32_t \*buf;/& (void)buf;/' < $@.tmp > $@
	$(RM) -f $@.tmp

# All sources depend on the xdr headers
$(APPLIB_SRCS): $(XDRHDRS)

#
# Default target is to build the library
#
all: applib

applib: libdtnapi.a
libdtnapi.a: $(APPLIB_OBJS)
	rm -f $@
	ar ruc $@ $^
	ranlib $@ || true

#
# Include the common rules
#
SRCDIR := ..
-include $(SRCDIR)/Rules.make

